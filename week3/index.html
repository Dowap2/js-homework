<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="./style/index.css" />
    <title>캐러셀 컴포넌트</title>
  </head>
  <body>
    <div class="carousel-container">
      <div class="carousel-header">
        <img
          src="./assets/game_icon.png"
          class="carousel-header-icon"
          alt="헤더 아이콘"
        />
        <p class="carousel-header-content">추천 게임</p>
        <img src="./assets/all.png" class="carousel-header-all" alt="" />
      </div>
      <div class="carousel-wrapper">
        <div class="carousel-track" id="carouselTrack">
          <div class="carousel-slide">
            <div class="slide-content">
              <div class="game-container">
                <div class="game-wrapper">
                  <img
                    src="./assets/크로노오디세이_배경.png"
                    class="bg-image"
                    alt="크로노오디세이"
                  />
                  <img
                    src="./assets/크로노오디세이_캐릭터.png"
                    class="overlay-image"
                    alt="크로노오디세이"
                  />
                </div>
                <div class="game-content">
                  <div class="game-content-title">크로노 오디세이</div>
                  <div class="game-description">멈춰 있던 시간이 흐른다</div>
                  <div class="game-genre">MMORPG</div>
                </div>
              </div>
              <div class="game-container">
                <div class="game-wrapper">
                  <img
                    src="./assets/아키에이지워_배경.png"
                    class="bg-image"
                    alt="아키에이지워"
                  />
                  <img
                    src="./assets/아키에이지워_캐릭터.png"
                    class="overlay-image"
                    alt="아키에이지워"
                  />
                </div>
                <div class="game-content">
                  <div class="game-content-title">아키에이지 워</div>
                  <div class="game-description">시대의 전설을 향해</div>
                  <div class="game-genre">MMORPG</div>
                </div>
              </div>
            </div>
          </div>

          <div class="carousel-slide">
            <div class="slide-content">
              <div class="game-container">
                <div class="game-wrapper">
                  <img
                    src="./assets/크로노오디세이_배경.png"
                    class="bg-image"
                    alt="크로노오디세이"
                  />
                  <img
                    src="./assets/크로노오디세이_캐릭터.png"
                    class="overlay-image"
                    alt="크로노오디세이"
                  />
                </div>
                <div class="game-content">
                  <div class="game-content-title">크로노 오디세이</div>
                  <div class="game-description">멈춰 있던 시간이 흐른다</div>
                  <div class="game-genre">MMORPG</div>
                </div>
              </div>
              <div class="game-container">
                <div class="game-wrapper">
                  <img
                    src="./assets/아키에이지워_배경.png"
                    class="bg-image"
                    alt="아키에이지워"
                  />
                  <img
                    src="./assets/아키에이지워_캐릭터.png"
                    class="overlay-image"
                    alt="아키에이지워"
                  />
                </div>
                <div class="game-content">
                  <div class="game-content-title">아키에이지 워</div>
                  <div class="game-description">시대의 전설을 향해</div>
                  <div class="game-genre">MMORPG</div>
                </div>
              </div>
            </div>
          </div>

          <div class="carousel-slide">
            <div class="slide-content">
              <div class="game-container">
                <div class="game-wrapper">
                  <img
                    src="./assets/크로노오디세이_배경.png"
                    class="bg-image"
                    alt="크로노오디세이"
                  />
                  <img
                    src="./assets/크로노오디세이_캐릭터.png"
                    class="overlay-image"
                    alt="크로노오디세이"
                  />
                </div>
                <div class="game-content">
                  <div class="game-content-title">크로노 오디세이</div>
                  <div class="game-description">멈춰 있던 시간이 흐른다</div>
                  <div class="game-genre">MMORPG</div>
                </div>
              </div>
              <div class="game-container">
                <div class="game-wrapper">
                  <img
                    src="./assets/아키에이지워_배경.png"
                    class="bg-image"
                    alt="아키에이지워"
                  />
                  <img
                    src="./assets/아키에이지워_캐릭터.png"
                    class="overlay-image"
                    alt="아키에이지워"
                  />
                </div>
                <div class="game-content">
                  <div class="game-content-title">아키에이지 워</div>
                  <div class="game-description">시대의 전설을 향해</div>
                  <div class="game-genre">MMORPG</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="carousel-indicators">
        <button
          class="carousel-controls prev-btn"
          id="prevBtn"
          aria-label="이전 슬라이드"
        >
          <img src="./assets/left_arrow.png" alt="prev-btn" />
        </button>
        <span class="current-index" id="currentIndex">1</span>
        <span class="total-pages">/ <span id="totalPages">3</span></span>
        <button
          class="carousel-controls next-btn"
          id="nextBtn"
          aria-label="다음 슬라이드"
        >
          <img src="./assets/right_arrow.png" alt="next-btn" />
        </button>
      </div>
    </div>

    <script>
      class Carousel {
        constructor(container) {
          this.container = container;
          this.track = container.querySelector("#carouselTrack");
          this.slides = container.querySelectorAll(".carousel-slide");
          this.prevBtn = container.querySelector("#prevBtn");
          this.nextBtn = container.querySelector("#nextBtn");
          this.currentIndexEl = container.querySelector("#currentIndex");
          this.totalPagesEl = container.querySelector("#totalPages");
          this.dots = container.querySelectorAll(".dot");

          this.currentSlide = 0;
          this.totalSlides = this.slides.length;

          this.init();
        }

        init() {
          this.updateDisplay();
          this.bindEvents();
          this.updateTotalPages();
        }

        bindEvents() {
          // 이전/다음 버튼 이벤트
          this.prevBtn.addEventListener("click", () => this.goToPrevSlide());
          this.nextBtn.addEventListener("click", () => this.goToNextSlide());

          // 키보드 네비게이션
          this.container.addEventListener("keydown", (e) =>
            this.handleKeydown(e)
          );
        }

        handleKeydown(e) {
          if (e.key === "ArrowLeft") {
            e.preventDefault();
            this.goToPrevSlide();
          } else if (e.key === "ArrowRight") {
            e.preventDefault();
            this.goToNextSlide();
          }
        }

        goToPrevSlide() {
          if (this.currentSlide > 0) {
            this.currentSlide--;
            this.updateDisplay();
          }
        }

        goToNextSlide() {
          if (this.currentSlide < this.totalSlides - 1) {
            this.currentSlide++;
            this.updateDisplay();
          }
        }

        goToSlide(index) {
          if (index >= 0 && index < this.totalSlides) {
            this.currentSlide = index;
            this.updateDisplay();
          }
        }

        updateDisplay() {
          // 슬라이드 위치 업데이트
          const translateX = -this.currentSlide * 100;
          this.track.style.transform = `translateX(${translateX}%)`;

          // 현재 인덱스 표시 업데이트
          this.currentIndexEl.textContent = this.currentSlide + 1;

          // 네비게이션 버튼 상태 업데이트
          this.updateButtonStates();
        }

        updateButtonStates() {
          // 이전 버튼 상태
          if (this.currentSlide === 0) {
            this.prevBtn.classList.add("disabled");
            this.prevBtn.setAttribute("disabled", "");
          } else {
            this.prevBtn.classList.remove("disabled");
            this.prevBtn.removeAttribute("disabled");
          }

          // 다음 버튼 상태
          if (this.currentSlide === this.totalSlides - 1) {
            this.nextBtn.classList.add("disabled");
            this.nextBtn.setAttribute("disabled", "");
          } else {
            this.nextBtn.classList.remove("disabled");
            this.nextBtn.removeAttribute("disabled");
          }
        }

        updateDots() {
          this.dots.forEach((dot, index) => {
            if (index === this.currentSlide) {
              dot.classList.add("active");
            } else {
              dot.classList.remove("active");
            }
          });
        }

        updateTotalPages() {
          this.totalPagesEl.textContent = this.totalSlides;
        }

        // 외부에서 슬라이드를 추가/제거할 때 사용할 메서드
        refresh() {
          this.slides = this.container.querySelectorAll(".carousel-slide");
          this.totalSlides = this.slides.length;
          this.updateTotalPages();

          // 현재 슬라이드가 범위를 벗어났으면 조정
          if (this.currentSlide >= this.totalSlides) {
            this.currentSlide = this.totalSlides - 1;
          }

          this.updateDisplay();
        }
      }

      // 캐러셀 초기화
      document.addEventListener("DOMContentLoaded", () => {
        const carouselContainer = document.querySelector(".carousel-container");
        const carousel = new Carousel(carouselContainer);

        // 전역으로 접근 가능하도록 설정 (개발 및 테스트용)
        window.carousel = carousel;
      });
    </script>
  </body>
</html>
